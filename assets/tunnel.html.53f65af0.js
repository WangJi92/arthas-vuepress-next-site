import{_ as i,a as c,b as d}from"./tunnel-server-agents.7f4782a0.js";import{_ as h,r as o,o as p,c as u,a as e,b as a,w as l,F as b,d as n,e as t}from"./app.1edb3735.js";const m={},_=e("h1",{id:"arthas-tunnel",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#arthas-tunnel","aria-hidden":"true"},"#"),n(" Arthas Tunnel")],-1),g=e("p",null,"Manage/connect multiple Agents remotely via Arthas Tunnel Server/Client.",-1),v=e("p",null,"For example, in streaming computing, Java processes can be started on different machines, and it can be difficult to use Arthas to diagnose them, because the user usually does not have access to the machine.",-1),f=e("p",null,"In this case, Arthas Tunnel Server/Client can be used.",-1),w=e("p",null,"Reference:",-1),x=n("1: "),y=n("Web Console"),k=n("2: "),I=n("Arthas Spring Boot Starter"),A=e("h3",{id:"download-and-deploy-arthas-tunnel-server",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#download-and-deploy-arthas-tunnel-server","aria-hidden":"true"},"#"),n(" Download and deploy arthas tunnel server")],-1),N={href:"https://github.com/alibaba/arthas/releases",target:"_blank",rel:"noopener noreferrer"},E=n("https://github.com/alibaba/arthas/releases"),R=t(`<p>Arthas tunnel server is a spring boot fat jar application, start with the <code>java -jar</code> command:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>java -jar  arthas-tunnel-server.jar
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>By default, the web port of the arthas tunnel server is <code>8080</code>, and the port connected by the arthas agent is <code>7777</code>.</p>`,3),L=n("Once started, you can go to "),T={href:"http://127.0.0.1:8080/",target:"_blank",rel:"noopener noreferrer"},S=n("http://127.0.0.1:8080/"),B=n(" and connect to the registered arthas agent via "),V=e("code",null,"agentId",-1),C=n("."),D=n("Through Spring Boot's Endpoint, you can view the specific connection information: "),O={href:"http://127.0.0.1:8080/actuator/arthas",target:"_blank",rel:"noopener noreferrer"},M=n("http://127.0.0.1:8080/actuator/arthas"),P=n(", the login user name is "),U=e("code",null,"arthas",-1),j=n(", and the password can be found in the log of arthas tunnel server, for example:"),F=t(`<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>32851 [main] INFO o.s.b.a.s.s.UserDetailsServiceAutoConfiguration

Using generated security password: f1dca050-3777-48f4-a577-6367e55a78a2
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="connecting-to-the-tunnel-server-when-starting-arthas" tabindex="-1"><a class="header-anchor" href="#connecting-to-the-tunnel-server-when-starting-arthas" aria-hidden="true">#</a> Connecting to the tunnel server when starting arthas</h3><p>When starting arthas, you can use the <code>--tunnel-server</code> parameter, for example:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>as.sh --tunnel-server &#39;ws://127.0.0.1:7777/ws&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>You can also use the following test address (not guaranteed to be available all the time):</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>as.sh --tunnel-server &#39;ws://47.75.156.201:80/ws&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>You can specify the agentId by the <code>--agent-id</code> parameter. By default, a random ID is generated.</li></ul><p>After Arthas attach succeeds, the agentId will be printed, such as:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>  ,---.  ,------. ,--------.,--.  ,--.  ,---.   ,---.
 /  O  \\ |  .--. &#39;&#39;--.  .--&#39;|  &#39;--&#39;  | /  O  \\ &#39;   .-&#39;
|  .-.  ||  &#39;--&#39;.&#39;   |  |   |  .--.  ||  .-.  |\`.  \`-.
|  | |  ||  |\\  \\    |  |   |  |  |  ||  | |  |.-&#39;    |
\`--&#39; \`--&#39;\`--&#39; &#39;--&#39;   \`--&#39;   \`--&#39;  \`--&#39;\`--&#39; \`--&#39;\`-----&#39;


wiki      https://arthas.aliyun.com/doc
tutorials https://arthas.aliyun.com/doc/arthas-tutorials.html
version   3.1.2
pid       86183
time      2019-08-30 15:40:53
id        URJZ5L48RPBR2ALI5K4V
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>If the connection is not connected to the tunnel server at startup, you can also obtain the agentId through the <code>session</code> command after reconnection succeeds:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>[arthas@86183]$ session
 Name           Value
-----------------------------------------------------
 JAVA_PID       86183
 SESSION_ID     f7273eb5-e7b0-4a00-bc5b-3fe55d741882
 AGENT_ID       URJZ5L48RPBR2ALI5K4V
 TUNNEL_SERVER  ws://47.75.156.201:80/ws
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div>`,11),J=n("For the above example, go to "),q={href:"http://47.75.156.201/arthas/?port=80",target:"_blank",rel:"noopener noreferrer"},Z=n("http://47.75.156.201/arthas/?port=80"),G=n(" in the browser and input the "),K=e("code",null,"agentId",-1),Y=n(" to connect to arthas on remote machine."),W=t('<p><img src="'+c+`" alt=""></p><h3 id="best-practices" tabindex="-1"><a class="header-anchor" href="#best-practices" aria-hidden="true">#</a> Best practices</h3><blockquote><p>Note that the agentId must be unique, otherwise it will conflict on the tunnel server and not work properly.</p></blockquote><p>If the arthas agent is configured with <code>appName</code>, the generated agentId will be prefixed with <code>appName</code>.</p><p>For example, if you add the startup parameter <code>as.sh --tunnel-server &#39;ws://127.0.0.1:7777/ws&#39; --app-name demoapp</code>, the generated agentId might be <code>demoapp_URJZ5L48RPBR2ALI5K4V</code>.</p><p>Tunnel server will use <code>_</code> as a delimiter to extract <code>appName</code>, which is convenient to manage by application.</p><blockquote><p>Alternatively, you can configure <code>appName</code> in <code>arthas.properties</code> in the unzipped arthas directory, or in <code>application.properties</code> of the spring boot application.</p></blockquote><h3 id="tunnel-server-management-page" tabindex="-1"><a class="header-anchor" href="#tunnel-server-management-page" aria-hidden="true">#</a> Tunnel Server Management Page</h3><p>Start the tunnel-server locally, then use <code>as.sh</code> attach, and specify the application name <code>--app-name test</code>:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ as.sh --tunnel-server &#39;ws://127.0.0.1:7777/ws&#39; --app-name test
telnet connecting to arthas server... current timestamp is 1627539688
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is &#39;^]&#39;.
  ,---.  ,------. ,--------.,--.  ,--.  ,---.   ,---.
 /  O  \\ |  .--. &#39;&#39;--.  .--&#39;|  &#39;--&#39;  | /  O  \\ &#39;   .-&#39;
|  .-.  ||  &#39;--&#39;.&#39;   |  |   |  .--.  ||  .-.  |\`.  \`-.
|  | |  ||  |\\  \\    |  |   |  |  |  ||  | |  |.-&#39;    |
\`--&#39; \`--&#39;\`--&#39; &#39;--&#39;   \`--&#39;   \`--&#39;  \`--&#39;\`--&#39; \`--&#39;\`-----&#39;


wiki       https://arthas.aliyun.com/doc
tutorials  https://arthas.aliyun.com/doc/arthas-tutorials.html
version    3.5.3
main_class demo.MathGame
pid        65825
time       2021-07-29 14:21:29
id         test_PE3LZO9NA9ENJYTPGL9L
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>Then visit tunnel-server, you can see a list of all connected applications:</p>`,11),$={href:"http://localhost:8080/apps.html",target:"_blank",rel:"noopener noreferrer"},z=n("http://localhost:8080/apps.html"),H=e("p",null,[e("img",{src:i,alt:""})],-1),Q=e("p",null,"Then open the details, you can see a list of all connected agents:",-1),X={href:"http://localhost:8080/agents.html?app=test",target:"_blank",rel:"noopener noreferrer"},ee=n("http://localhost:8080/agents.html?app=test"),ne=t('<p><img src="'+d+`" alt=""></p><h3 id="authority-management" tabindex="-1"><a class="header-anchor" href="#authority-management" aria-hidden="true">#</a> Authority Management</h3><p>At present, the tunnel server does not have special authority management. Users need to develop their own and authenticate the app name.</p><h3 id="cluster-management" tabindex="-1"><a class="header-anchor" href="#cluster-management" aria-hidden="true">#</a> Cluster Management</h3><p>If you want to deploy multiple tunnel servers, you can use nginx for forwarding and redis to store agent information.</p><p>Nginx needs to configure sticky session to ensure that the user&#39;s web socket is connected to the same back-end tunnel server. The simple configuration method is to use <code>ip_hash</code>.</p><h3 id="how-arthas-tunnel-server-works" tabindex="-1"><a class="header-anchor" href="#how-arthas-tunnel-server-works" aria-hidden="true">#</a> How arthas tunnel server works</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>browser &lt;-&gt; arthas tunnel server &lt;-&gt; arthas tunnel client &lt;-&gt; arthas agent
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div>`,8),ae={href:"https://github.com/alibaba/arthas/blob/master/tunnel-server/README.md#",target:"_blank",rel:"noopener noreferrer"},se=n("tunnel-server/README.md");function te(re,oe){const r=o("RouterLink"),s=o("ExternalLinkIcon");return p(),u(b,null,[_,g,v,f,w,e("ul",null,[e("li",null,[x,a(r,{to:"/en/doc/web-console.html"},{default:l(()=>[y]),_:1})]),e("li",null,[k,a(r,{to:"/en/doc/spring-boot-starter.html"},{default:l(()=>[I]),_:1})])]),A,e("p",null,[e("a",N,[E,a(s)])]),R,e("p",null,[L,e("a",T,[S,a(s)]),B,V,C]),e("p",null,[D,e("a",O,[M,a(s)]),P,U,j]),F,e("p",null,[J,e("a",q,[Z,a(s)]),G,K,Y]),W,e("p",null,[e("a",$,[z,a(s)])]),H,Q,e("p",null,[e("a",X,[ee,a(s)])]),ne,e("p",null,[e("a",ae,[se,a(s)])])],64)}var ce=h(m,[["render",te],["__file","tunnel.html.vue"]]);export{ce as default};
